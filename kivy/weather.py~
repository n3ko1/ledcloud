from json import load
from urllib2 import urlopen
from pprint import pprint

class WeatherAPI:
    weatherAPIUrl = 'http://openweathermap.org/data/2.1/find/name?q=%s'
    descriptions = { 'sky is clear': 1, 
                     'few clouds': 2, 
                     'scattered clouds': 3, 
                     'broken clouds': 4,
                     'shower rain': 5,
                     'Rain': 6,
                     'Thunderstorm': 7,
                     'snow': 8,
                     'mist': 9 }

    def __init__(self, cityName):
        data = urlopen(self.weatherAPIUrl % (cityName))
        cities = load(data)
        if cities['count'] > 0:
            self.city = cities['list'][0]

    def getTemperature(self):
        return float(self.city['main']['temp']) - 273.15

    def getWeatherCode(self):
        return self.descriptions[self.city['weather'][0]['description']]
        
    def getWeather(self):
        return self.city['weather'][0]['description']
